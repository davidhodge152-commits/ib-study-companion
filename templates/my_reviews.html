{% extends "base.html" %}
{% block title %}My Reviews â€” IB Study Companion{% endblock %}

{% block content %}
<div class="space-y-6">
    <h1 class="text-2xl font-bold">My Submitted Reviews</h1>

    <div id="reviews-list" class="space-y-4">
        <p class="text-sm text-slate-500">Loading your submissions...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const STATUS_BADGES = {
    submitted: 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300',
    assigned: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',
    reviewed: 'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300',
    delivered: 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300',
};

async function loadMyReviews() {
    const res = await fetch('/api/reviews/mine');
    const data = await res.json();
    const el = document.getElementById('reviews-list');
    if (!data.reviews || data.reviews.length === 0) {
        el.innerHTML = '<p class="text-sm text-slate-500">No submissions yet. Submit work for examiner review from the study page.</p>';
        return;
    }
    el.innerHTML = data.reviews.map(r => `
        <div class="bg-white dark:bg-slate-800 rounded-xl p-5 shadow-sm">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold">${r.title || r.doc_type}</h3>
                <span class="text-xs px-2 py-0.5 rounded-full ${STATUS_BADGES[r.status] || STATUS_BADGES.submitted}">${r.status}</span>
            </div>
            <p class="text-sm text-slate-500">${r.subject} &middot; ${r.doc_type} &middot; Submitted: ${r.submitted_at || '-'}</p>
            ${r.status === 'delivered' && r.examiner_feedback ? `
                <div class="mt-3 bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                    <h4 class="text-sm font-semibold text-green-800 dark:text-green-300 mb-1">Examiner Feedback</h4>
                    <p class="text-sm text-green-700 dark:text-green-400 whitespace-pre-line">${r.examiner_feedback}</p>
                    ${r.examiner_grade ? `<p class="text-sm font-medium mt-2">Grade: ${r.examiner_grade}</p>` : ''}
                    ${r.examiner_video_url ? `<a href="${r.examiner_video_url}" target="_blank" class="text-sm text-indigo-600 hover:underline mt-1 inline-block">Watch video feedback</a>` : ''}
                </div>
            ` : ''}
        </div>
    `).join('');
}
loadMyReviews();
</script>
{% endblock %}
