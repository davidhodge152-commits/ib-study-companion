{% extends "base.html" %}
{% block title %}Upload â€” IB Study Companion{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-2xl font-bold text-slate-800">Upload Documents</h1>
    <p class="text-slate-500 text-sm mt-1">Upload IB PDFs to build your knowledge base.</p>
</div>

<!-- Document Type Selection -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6">
    <label class="block text-sm font-medium text-slate-700 mb-3">Document Type</label>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="doc-type-selector">
        <button type="button" data-type="past_paper"
                class="doc-type-btn active px-4 py-3 rounded-lg border-2 border-indigo-500 bg-indigo-50 text-indigo-700 text-sm font-medium transition-all">
            Past Paper
        </button>
        <button type="button" data-type="mark_scheme"
                class="doc-type-btn px-4 py-3 rounded-lg border-2 border-slate-200 bg-white text-slate-600 text-sm font-medium hover:border-slate-300 transition-all">
            Mark Scheme
        </button>
        <button type="button" data-type="notes"
                class="doc-type-btn px-4 py-3 rounded-lg border-2 border-slate-200 bg-white text-slate-600 text-sm font-medium hover:border-slate-300 transition-all">
            My Notes
        </button>
        <button type="button" data-type="my_past_exam"
                class="doc-type-btn px-4 py-3 rounded-lg border-2 border-slate-200 bg-white text-slate-600 text-sm font-medium hover:border-slate-300 transition-all">
            My Past Exam
        </button>
    </div>
    <p class="text-xs text-slate-400 mt-2" id="doc-type-hint">
        Upload official IB past papers for question reference.
    </p>
</div>

<!-- Drag & Drop Zone -->
<div id="drop-zone"
     class="bg-white rounded-xl shadow-sm border-2 border-dashed border-slate-300 p-12 text-center mb-6 transition-colors hover:border-indigo-400 cursor-pointer">
    <input type="file" id="file-input" accept=".pdf" class="hidden" multiple>
    <svg class="w-12 h-12 mx-auto text-slate-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
    </svg>
    <p class="text-slate-600 font-medium">Drag & drop PDF files here</p>
    <p class="text-sm text-slate-400 mt-1">or click to browse</p>
</div>

<!-- Upload Progress -->
<div id="upload-progress" class="hidden mb-6">
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-slate-700" id="upload-filename">Uploading...</span>
            <span class="text-sm text-slate-500" id="upload-status">Processing</span>
        </div>
        <div class="w-full bg-slate-100 rounded-full h-2">
            <div id="upload-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>
</div>

<!-- Upload Result -->
<div id="upload-result" class="hidden mb-6"></div>

<!-- Recently Uploaded -->
{% if uploads %}
<h2 class="text-lg font-semibold text-slate-700 mb-4">Recent Uploads</h2>
<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
    <table class="w-full text-sm">
        <thead class="bg-slate-50 border-b border-slate-200">
            <tr>
                <th class="text-left px-5 py-3 font-medium text-slate-600">File</th>
                <th class="text-left px-5 py-3 font-medium text-slate-600">Type</th>
                <th class="text-left px-5 py-3 font-medium text-slate-600">Subject</th>
                <th class="text-center px-5 py-3 font-medium text-slate-600">Chunks</th>
                <th class="text-right px-5 py-3 font-medium text-slate-600">Date</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
            {% for u in uploads|reverse %}
            <tr class="hover:bg-slate-50 transition-colors">
                <td class="px-5 py-3 text-slate-700 font-medium">{{ u.filename }}</td>
                <td class="px-5 py-3">
                    <span class="px-2 py-0.5 text-xs rounded-full
                                 {% if u.doc_type == 'past_paper' %}bg-blue-100 text-blue-700
                                 {% elif u.doc_type == 'mark_scheme' %}bg-purple-100 text-purple-700
                                 {% elif u.doc_type == 'my_past_exam' %}bg-amber-100 text-amber-700
                                 {% else %}bg-slate-100 text-slate-600{% endif %}">
                        {{ u.doc_type | replace('_', ' ') | title }}
                    </span>
                </td>
                <td class="px-5 py-3 text-slate-600">{{ u.subject | replace('_', ' ') | title }}</td>
                <td class="px-5 py-3 text-center text-slate-500">{{ u.chunks }}</td>
                <td class="px-5 py-3 text-right text-slate-400 text-xs">{{ u.uploaded_at[:10] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<script>
const DOC_TYPE_HINTS = {
    past_paper: 'Upload official IB past papers for question reference.',
    mark_scheme: 'Upload mark schemes so the grader can reference real criteria.',
    notes: 'Upload your class notes, textbook excerpts, or study guides.',
    my_past_exam: 'Upload your own graded exams. This will analyze your writing style for personalized feedback.'
};

// Doc type selector
let selectedDocType = 'past_paper';
document.querySelectorAll('.doc-type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.doc-type-btn').forEach(b => {
            b.classList.remove('active', 'border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
            b.classList.add('border-slate-200', 'bg-white', 'text-slate-600');
        });
        btn.classList.add('active', 'border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
        btn.classList.remove('border-slate-200', 'bg-white', 'text-slate-600');
        selectedDocType = btn.dataset.type;
        document.getElementById('doc-type-hint').textContent = DOC_TYPE_HINTS[selectedDocType];
    });
});
</script>
{% endblock %}
